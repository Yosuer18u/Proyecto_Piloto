CREATE DATABASE GALACTICUSBD;
USE GALACTICUSBD;

-- TABLA SUCURSALES 
CREATE TABLE SUCURSALES (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    NOMBRE VARCHAR(50) NOT NULL,
    DIRECCION VARCHAR(250) NOT NULL,
    TELEFONO VARCHAR(20) NOT NULL,
    CORREO VARCHAR(50) NOT NULL,
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1
);

-- TABLA CATEGORIAS
CREATE TABLE CATEGORIAS (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    SUCURSAL_ID INT NOT NULL,
    NOMBRE VARCHAR(150) NOT NULL,
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_CATEGORIAS_SUCURSALES
    FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSALES (ID)
);

-- TABLA PROVEEDORES
CREATE TABLE PROVEEDORES (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    SUCURSAL_ID INT NOT NULL,
    NOMBRE VARCHAR(150) NOT NULL,
    RUC VARCHAR(15) NOT NULL,
    TELEFONO VARCHAR(50) NOT NULL,
    DIRECCION VARCHAR(150) NOT NULL,
    CORREO VARCHAR(150) NOT NULL,
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_PROVEEDORES_SUCURSALES
    FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSALES (ID)
);

-- TABLA MONEDAS
CREATE TABLE MONEDAS (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    SUCURSAL_ID INT NOT NULL,
    NOMBRE VARCHAR(50) NOT NULL,
    SIMBOLO VARCHAR(20),
    CODIGO_ISO VARCHAR(20),
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_MONEDAS_SUCURSALES
    FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSALES (ID)
);

-- TABLA PRODUCTOS
CREATE TABLE PRODUCTOS (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    SUCURSAL_ID INT NOT NULL,
    CATEGORIA_ID INT NOT NULL,
    NOMBRE VARCHAR(150) NOT NULL,
    DESCRIPCION VARCHAR(250) NOT NULL,
    STOCK INT,
    PROVEEDOR_ID INT NOT NULL,
    MONEDA_ID INT NOT NULL,
    PRECIO_VENTA NUMERIC(18, 2),
    PRODUCTO_IMG VARCHAR(MAX),
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_PRODUCTOS_SUCURSALES
    FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSALES (ID),
    CONSTRAINT FK_PRODUCTOS_CATEGORIAS
    FOREIGN KEY (CATEGORIA_ID) REFERENCES CATEGORIAS (ID),
    CONSTRAINT FK_PRODUCTOS_PROVEEDORES
    FOREIGN KEY (PROVEEDOR_ID) REFERENCES PROVEEDORES (ID),
    CONSTRAINT FK_PRODUCTOS_MONEDAS
    FOREIGN KEY (MONEDA_ID) REFERENCES MONEDAS (ID)
);

-- TABLA DOCUMENTOS
CREATE TABLE DOCUMENTOS (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    NOMBRE VARCHAR(50),
    TIPO VARCHAR(150), 
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1
);

-- TABLA PAGOS
CREATE TABLE PAGOS (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    NOMBRE VARCHAR(150),
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1
);

-- TABLA ROLES
CREATE TABLE ROLES (
    ROL_ID INT IDENTITY(1,1) PRIMARY KEY,
    SUCURSAL_ID INT NOT NULL,
    NOMBRE VARCHAR(150),
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_ROLES_SUCURSALES
    FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSALES (ID)
);

-- TABLA USUARIOS
CREATE TABLE USUARIOS (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    SUCURSAL_ID INT NOT NULL,
    CORREO VARCHAR(150) NOT NULL,
    NOMBRE VARCHAR(150),
    APELLIDO VARCHAR(150),
    DNI VARCHAR(50),
    TELEFONO VARCHAR(50),
    CONTRASENIA VARCHAR(50) NOT NULL,
    ROL_ID INT NOT NULL,
    IMAGEN VARCHAR(MAX),
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    EST INT,
    CONSTRAINT FK_USUARIOS_SUCURSALES
    FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSALES (ID),
    CONSTRAINT FK_USUARIOS_ROLES
    FOREIGN KEY (ROL_ID) REFERENCES ROLES (ROL_ID)
);

-- TABLA COMPRAS
CREATE TABLE COMPRAS (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    SUCURSAL_ID INT NOT NULL,
    PAGO_ID INT NOT NULL,
    COMENTARIO VARCHAR(500),
    USUARIO_ID INT NOT NULL,
    MONEDA_ID INT NOT NULL,
    DOCUMENTO_ID INT NOT NULL,    
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_COMPRAS_SUCURSALES
    FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSALES (ID),
    FOREIGN KEY (PAGO_ID) REFERENCES PAGOS (ID),
    FOREIGN KEY (USUARIO_ID) REFERENCES USUARIOS (ID),
    FOREIGN KEY (MONEDA_ID) REFERENCES MONEDAS (ID),
    FOREIGN KEY (DOCUMENTO_ID) REFERENCES DOCUMENTOS (ID)
);

-- TABLA COMPRADETALLES
CREATE TABLE COMPRADETALLES (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    COMPRA_ID INT NOT NULL,
    PRODUCTO_ID INT NOT NULL,
    PRODUCTO_PRECIO_COMPRA NUMERIC(18, 2) NOT NULL,
    CANTIDAD INT NOT NULL,
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_COMPRADETALLES_COMPRAS
    FOREIGN KEY (COMPRA_ID) REFERENCES COMPRAS (ID),
    CONSTRAINT FK_COMPRADETALLES_PRODUCTOS
    FOREIGN KEY (PRODUCTO_ID) REFERENCES PRODUCTOS (ID)
);

-- TABLA MENUS
CREATE TABLE MENUS (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    NOMBRE VARCHAR(150) NOT NULL,
    RUTA VARCHAR(250) NOT NULL,
    IDENTIFICADOR VARCHAR(150) NOT NULL,
    GRUPO VARCHAR(150) NOT NULL,
    ICONO VARCHAR(150) NOT NULL,
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1
);

-- TABLA MENUDETALLES
CREATE TABLE MENUDETALLES (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    MENU_ID INT NOT NULL,
    ROL_ID INT NOT NULL,
    PERMITIDO BIT DEFAULT 0,
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_MENUDETALLES_MENUS
    FOREIGN KEY (MENU_ID) REFERENCES MENUS (ID),
    CONSTRAINT FK_MENUDETALLES_ROLES
    FOREIGN KEY (ROL_ID) REFERENCES ROLES (ROL_ID)
);

-- TABLA CLIENTES
CREATE TABLE CLIENTES (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    SUCURSAL_ID INT NOT NULL,
    NOMBRE VARCHAR(150) NOT NULL,
    RUC VARCHAR(15),
    DNI VARCHAR(15),
    TELEFONO VARCHAR(50),
    DIRECCION VARCHAR(150),
    CORREO VARCHAR(150),
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_CLIENTES_SUCURSALES
    FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSALES (ID)
);

-- TABLA VENTAS
CREATE TABLE VENTAS (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    SUCURSAL_ID INT NOT NULL,
    PAGO_ID INT NOT NULL,
    CLIENTE_ID INT NOT NULL,
    COMENTARIO VARCHAR(500),
    USUARIO_ID INT NOT NULL,
    MONEDA_ID INT NOT NULL,
    DOCUMENTO_ID INT NOT NULL,
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_VENTAS_SUCURSALES
    FOREIGN KEY (SUCURSAL_ID) REFERENCES SUCURSALES (ID),
    CONSTRAINT FK_VENTAS_PAGOS
    FOREIGN KEY (PAGO_ID) REFERENCES PAGOS (ID),
    CONSTRAINT FK_VENTAS_CLIENTES
    FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTES (ID),
    CONSTRAINT FK_VENTAS_USUARIOS
    FOREIGN KEY (USUARIO_ID) REFERENCES USUARIOS (ID),
    CONSTRAINT FK_VENTAS_MONEDAS
    FOREIGN KEY (MONEDA_ID) REFERENCES MONEDAS (ID),
    CONSTRAINT FK_VENTAS_DOCUMENTOS
    FOREIGN KEY (DOCUMENTO_ID) REFERENCES DOCUMENTOS (ID)
);

-- TABLA VENTADETALLES
CREATE TABLE VENTADETALLES (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    VENTA_ID INT NOT NULL,
    PRODUCTO_ID INT NOT NULL,
    PRODUCTO_PRECIO_VENTA NUMERIC(18, 2) NOT NULL,
    CANTIDAD INT NOT NULL,
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    CONSTRAINT FK_VENTADETALLES_VENTAS
    FOREIGN KEY (VENTA_ID) REFERENCES VENTAS (ID),
    FOREIGN KEY (PRODUCTO_ID) REFERENCES PRODUCTOS (ID)
);

-- TABLA UNIDADES
CREATE TABLE UNIDADES (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    SUCURSAL_ID INT NOT NULL,
    NOMBRE VARCHAR(150) NOT NULL,
    FECHA_CREACION DATETIME DEFAULT GETDATE(),
    ESTADO BIT DEFAULT 1,
    FOREIGN KEY (SUCURSAL_ID) REFERENCES Sucursales (ID)
);
